{% extends "base.html" %} 
{% load i18n %}
{% load static %}
{% load widget_tweaks %}

{% block title %} {% trans "Recipes" %} {% endblock %} 
  
{% block body %}

<div class="container mt-4">
  <section class="mt-5 p-3 rounded shadow-lg recipe-section">

    <h2  class="h4 mb-4 d-flex align-items-center">{% trans "New Recipe Suggestions" %}</h2>
  {% if not recipe_gen_in_progress %}
   {% if latest_suggestions %}
  <div class="accordion" id="latestSuggestionsAccordion">
    {% for recipe in latest_suggestions %}
    <div class="card recipe-card mb-3">
      <div class="accordion-item">
        <h4 class="accordion-header" id="headingLatest{{ forloop.counter }}">
          <button
            class="accordion-button collapsed {% if not recipe.is_seen %}unseen-recipe{% endif %}"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseLatest{{ forloop.counter }}"
            aria-expanded="false"
            aria-controls="collapseLatest{{ forloop.counter }}"
            data-recipe-id="{{recipe.id}}"
          >
            {{ recipe.recipe_data.title }}
          </button>
        </h4>
        <div
          id="collapseLatest{{ forloop.counter }}"
          class="accordion-collapse collapse"
          aria-labelledby="headingLatest{{ forloop.counter }}"
          data-bs-parent="#latestSuggestionsAccordion"
        >
          <div class="accordion-body">
            <h5>{% trans "Ingredients" %}</h5>
            <ul>
              {% for ingredient in recipe.recipe_data.ingredients %}
              <li>
                {{ ingredient.quantity }} {{ ingredient.unit }} of {{ ingredient.name }}
              </li>
              {% endfor %}
            </ul>
            <h5>{% trans "Instructions" %}</h5>
            <ol>
              {% for instruction in recipe.recipe_data.instructions %}
              <li>{{ instruction }}</li>
              {% endfor %}
            </ol>
            <button
              class="btn btn-primary save-recipe-btn mt-3"
              data-recipe-id="{{recipe.id}}"
              data-csrf-token="{{csrf_token}}"
            >
              {% trans "Save Recipe" %}
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info" role="alert">{% trans "No new suggestions" %}</div>
  {% endif %} {% else %}
  <div class="alert alert-info" role="alert">{% trans "Recipes still being generated" %}</div>
  {% endif %}
  </section>
  
  <section class="mt-5 p-3 rounded shadow-lg recipe-section">
    <h2 class="h4 mb-4 d-flex align-items-center">{% trans "Recently Suggested Recipes" %}</h2>
  {% if recently_suggested %}
  <div class="accordion" id="recentlySuggestedAccordion">
    {% for recipe in recently_suggested %}
    <div class="card recipe-card mb-3">
      <div class="accordion-item">
        <h4 class="accordion-header" id="headingRecent{{ forloop.counter }}">
          <button
            class="accordion-button collapsed {% if not recipe.is_seen %}unseen-recipe{% endif %}"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseRecent{{ forloop.counter }}"
            aria-expanded="false"
            aria-controls="collapseRecent{{ forloop.counter }}"
            data-recipe-id="{{recipe.id}}"
          >
            {{ recipe.recipe_data.title }}
          </button>
        </h4>
        <div
          id="collapseRecent{{ forloop.counter }}"
          class="accordion-collapse collapse"
          aria-labelledby="headingRecent{{ forloop.counter }}"
          data-bs-parent="#recentlySuggestedAccordion"
        >
          <div class="accordion-body">
            <h5>{% trans "Ingredients" %}</h5>
            <ul>
              {% for ingredient in recipe.recipe_data.ingredients %}
              <li>
                {{ ingredient.quantity }} {{ ingredient.unit }} of {{ ingredient.name }}
              </li>
              {% endfor %}
            </ul>
            <h5>{% trans "Instructions" %}</h5>
            <ol>
              {% for instruction in recipe.recipe_data.instructions %}
              <li>{{ instruction }}</li>
              {% endfor %}
            </ol>
            <button
              class="btn btn-primary save-recipe-btn mt-3"
              data-recipe-id="{{recipe.id}}"
              data-csrf-token="{{csrf_token}}"
            >
              {% trans "Save Recipe" %}
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info" role="alert">{% trans "No recently suggested" %}</div>
  {% endif %}
  </section>
  

  <section class="mt-5 p-3 rounded shadow-lg recipe-section">
    <h2 class="h4 mb-4 d-flex align-items-center">{% trans "Saved Recipes" %}</h2>
    <div class="accordion" id="saved-recipes-accordion">
      {% if saved_recipes_data %} 
        {% for recipe_data in saved_recipes_data %}
        <div class="card recipe-card mb-3">
          <div class="accordion-item">
            <h4 class="accordion-header" id="headingSaved{{ forloop.counter }}">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapseSaved{{ forloop.counter }}"
                aria-expanded="false"
                aria-controls="collapseSaved{{ forloop.counter }}"
              >
                {{ recipe_data.recipe.title }}
                {% if not recipe_data.has_all_ingredients %}
                <span class="badge bg-danger ms-2">{% trans "Missing Items" %}</span>
                {% endif %}
              </button>
            </h4>
            <div
              id="collapseSaved{{ forloop.counter }}"
              class="accordion-collapse collapse"
              aria-labelledby="headingSaved{{ forloop.counter }}"
              data-bs-parent="#saved-recipes-accordion"
            >
              <div class="accordion-body">
                <h5>{% trans "Ingredients" %}</h5>
                <ul>
                  {% for ingredient_instance in recipe_data.recipe.savedrecipeingredient_set.all %}
                  <li>
                    {{ ingredient_instance.quantity }} {{ ingredient_instance.unit }} of {{ ingredient_instance.product.product_name }}
                    
                    {% for missing_data in recipe_data.missing_ingredients %}
                      {% if ingredient_instance.product.id == missing_data.ingredient.product.id %}
                        {% if missing_data.status == 'completely_missing' %}
                        <span class="badge bg-danger ms-2">Completely Missing</span>
                        {% elif missing_data.status == 'alternative_available' %}
                        <span class="badge bg-warning ms-2">Alternative Available</span>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </li>
                  {% endfor %}
                </ul>
                <h5>{% trans "Instructions" %}</h5>
                <ol>
                  {% for instruction in recipe_data.recipe.instructions %}
                  <li>{{ instruction }}</li>
                  {% endfor %}
                </ol>
                <button
                  class="btn btn-danger delete-btn"
                  data-recipe-id="{{recipe_data.recipe.id}}"
                  data-csrf-token="{{csrf_token}}"
                >
                  {% trans "Delete Recipe" %}
                </button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %} 
      {% endif %}
    </div>

    {% if not saved_recipes_data %}
    <div id="no-saved-recipes-alert" class="alert alert-info" role="alert">
      {% trans "No Saved Recipes" %}
    </div>
    {% endif %}
  </section>

  
{% block extra_js %}
<script src="{% static 'recipes/recipes.js' %}"></script>
{% endblock extra_js %} 
{% endblock %}
